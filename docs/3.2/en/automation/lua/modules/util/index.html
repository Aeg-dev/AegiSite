<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://aeg-dev.github.io/AegiSite/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://aeg-dev.github.io/AegiSite/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://aeg-dev.github.io/AegiSite/main.569569a1e015e4f3bc7712f044c9f89bcb53f94c8171f6c68b4bf3f48750e955d2fafceda6e7e8afd0b9e26e60a2e4c8fde6fab574d7047d87e2e4005aa21c58.css integrity="sha512-VpVpoeAV5PO8dxLwRMn4m8tT+UyBcfbGi0vz9IdQ6VXS+vztpufor9C54m5gouTI/eb6tXTXBH2H4uQAWqIcWA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>- Aegisub</title><meta name=description content="Aegisub is a free, cross-platform open source tool for creating and modifying subtitles. Aegisub makes it quick and easy to time subtitles to audio, and features many powerful tools for styling them, including a built-in real-time video preview."><link rel=canonical href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/automation/lua/modules/util/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/doks.png"><meta name=twitter:title content><meta name=twitter:description content="The Automation 4 Lua include file utils.lua contains various support functions to aid writing Lua scripts. There is no general theme for the file.
Usage Import this module with util = require 'aegisub.util'{:.language-lua}.
Table functions Duplicating tables in various ways is a common task. util provides some functions to handle the most common cases.
copy Synopsis: newtable = util.copy(oldtable){:.language-lua}
Makes a shallow copy of the table passed as parameter. Shallow here means that it does not dive into contained tables and copy those as well."><meta name=twitter:site content="@henkverlinde"><meta name=twitter:creator content="@henkverlinde"><meta property="og:title" content><meta property="og:description" content="The Automation 4 Lua include file utils.lua contains various support functions to aid writing Lua scripts. There is no general theme for the file.
Usage Import this module with util = require 'aegisub.util'{:.language-lua}.
Table functions Duplicating tables in various ways is a common task. util provides some functions to handle the most common cases.
copy Synopsis: newtable = util.copy(oldtable){:.language-lua}
Makes a shallow copy of the table passed as parameter. Shallow here means that it does not dive into contained tables and copy those as well."><meta property="og:type" content="article"><meta property="og:url" content="/docs/3.2/en/automation/lua/modules/util/"><meta property="og:image" content="/doks.png"><meta property="og:site_name" content="Aegisub"><meta property="article:publisher" content="https://www.facebook.com/verlinde.henk"><meta property="article:author" content="https://www.facebook.com/verlinde.henk"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/aeg-dev.github.io\/AegiSite\/"},{"@type":"ListItem","position":3,"name":"Docs","item":"https:\/\/aeg-dev.github.io\/AegiSite\/\/docs\/"},{"@type":"ListItem","position":4,"name":"3.2","item":"https:\/\/aeg-dev.github.io\/AegiSite\/\/docs\/3.2\/"},{"@type":"ListItem","position":5,"name":"En","item":"https:\/\/aeg-dev.github.io\/AegiSite\/\/docs\/3.2\/en\/"},{"@type":"ListItem","position":6,"name":"Automation","item":"https:\/\/aeg-dev.github.io\/AegiSite\/\/docs\/3.2\/en\/automation\/"},{"@type":"ListItem","position":7,"name":"Lua","item":"https:\/\/aeg-dev.github.io\/AegiSite\/\/docs\/3.2\/en\/automation\/lua\/"},{"@type":"ListItem","position":8,"name":"Modules","item":"https:\/\/aeg-dev.github.io\/AegiSite\/\/docs\/3.2\/en\/automation\/lua\/modules\/"},{"@type":"ListItem","position":9,"name":"Util","item":"https:\/\/aeg-dev.github.io\/AegiSite\/\/docs\/3.2\/en\/automation\/lua\/modules\/util\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://aeg-dev.github.io/AegiSite/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://aeg-dev.github.io/AegiSite/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://aeg-dev.github.io/AegiSite/favicon-16x16.png><link rel=manifest href=https://aeg-dev.github.io/AegiSite/site.webmanifest></head><body class="docs single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://aeg-dev.github.io/AegiSite/>Aegisub</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/Aegisub/Aegisub><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2 text-nowrap"><li class=nav-item><a class=nav-link href=https://aeg-dev.github.io/AegiSite/downloads/main/>Downloads</a></li><li class="nav-item active"><a class=nav-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/main_page/>Docs</a></li><li class=nav-item><a class=nav-link href=https://github.com/Aegisub/Aegisub/issues>Bug Tracker</a></li><li class=nav-item><a class=nav-link href=https://aeg-dev.github.io/AegiSite/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=http://blog.aegisub.org/>Old News</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Navigation</h3><ul class=list-unstyled><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/main_page/>Main Page</a></li></ul><h3>Introduction</h3><ul class=list-unstyled><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/about/>What is Aegisub?</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/highlights/>Highlights</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/credits/>Credits</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/support/>Support Aegisub</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/faq/>FAQ</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/tutorials/>Tutorials</a></li></ul><h3>Working with Subtitles</h3><ul class=list-unstyled><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/editing_subtitles/>Editing Subtitles</a></li></ul><h3>Typesetting</h3><ul class=list-unstyled><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/typesetting/>Typesetting Introduction</a></li></ul><h3>Timing</h3><ul class=list-unstyled><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/audio/>Working with Audio</a></li></ul><h3>Automation</h3><ul class=list-unstyled><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/automation/>Overview</a></li></ul><h3>Miscellaneous</h3><ul class=list-unstyled><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/options/>Aegisub Options</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/properties/>Script Properties</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/attachment_manager/>Attachment Manager</a></li><li><a class=docs-link href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/commands/>Commands</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#usage>Usage</a></li><li><a href=#table-functions>Table functions</a><ul><li><a href=#copy>copy</a></li><li><a href=#deep_copy>deep_copy</a></li></ul></li><li><a href=#colour-functions>Colour functions</a><ul><li><a href=#ass_color>ass_color</a></li><li><a href=#ass_alpha>ass_alpha</a></li><li><a href=#ass_style_color>ass_style_color</a></li><li><a href=#extract_color>extract_color</a></li><li><a href=#alpha_from_style>alpha_from_style</a></li><li><a href=#color_from_style>color_from_style</a></li><li><a href=#hsv_to_rgb>HSV_to_RGB</a></li></ul></li><li><a href=#string-functions>String functions</a><ul><li><a href=#stringtrim>string.trim</a></li><li><a href=#stringheadtail>string.headtail</a></li><li><a href=#stringwords>string.words</a></li></ul></li><li><a href=#numeric-functions>Numeric functions</a><ul><li><a href=#clamp>clamp</a></li><li><a href=#interpolate>interpolate</a></li><li><a href=#interpolate_color>interpolate_color</a></li><li><a href=#interpolate_alpha>interpolate_alpha</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1></h1><p class=lead></p><p>The Automation 4 Lua include file <code>utils.lua</code> contains various support functions to aid writing Lua scripts.
There is no general theme for the file.</p><h2 id=usage>Usage<a href=#usage class=anchor aria-hidden=true>#</a></h2><p>Import this module with <code>util = require 'aegisub.util'</code>{:.language-lua}.</p><h2 id=table-functions>Table functions<a href=#table-functions class=anchor aria-hidden=true>#</a></h2><p>Duplicating tables in various ways is a common task.
<code>util</code> provides some functions to handle the most common cases.</p><h3 id=copy>copy<a href=#copy class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>newtable = util.copy(oldtable)</code>{:.language-lua}</p><p>Makes a shallow copy of the table passed as parameter.
Shallow here means that it does not dive into contained tables and copy those as well.
For example, if <code>oldtable.st</code> refers to a table, <code>newtable.st</code> will refer to the same table, and changes made to <code>newtable.st</code> will also be reflected in <code>oldtable.st</code> and vice versa.</p><h3 id=deep_copy>deep_copy<a href=#deep_copy class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>newtable = util.deep_copy(oldtable)</code>{:.language-lua}</p><p>Makes a deep copy of the table passed as parameter.
While this function attempts to handle circular references and not do infinite recursion on them, it might not work in all cases.
You will rarely need to use this function.
If you think you need to do a deep copy, consider your task an extra time.</p><h2 id=colour-functions>Colour functions<a href=#colour-functions class=anchor aria-hidden=true>#</a></h2><p>It is often useful to do various transformations on colour data. Several
functions for this are included.</p><h3 id=ass_color>ass_color<a href=#ass_color class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>colorstring = util.ass_color(r, g, b)</code>{:.language-lua}</p><p>Makes an ASS colour string in the form <code>&HBBGGRR</code> from the given <code>r</code>, <code>g</code> and <code>b</code> arguments.</p><p>Warning: The arguments are not checked for range.
Values outside the 0..255 range will produce garbage output.</p><h3 id=ass_alpha>ass_alpha<a href=#ass_alpha class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>alphastring = util.ass_alpha(a)</code>{:.language-lua}</p><p>Makes an ASS alpha string in the form <code>&HAA&</code> from the given <code>a</code> argument.</p><p>Does not check input range.</p><h3 id=ass_style_color>ass_style_color<a href=#ass_style_color class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>colorstring = util.ass_style_color(r, g, b, a)</code>{:.language-lua}</p><p>Makes an ASS colour string suitable for use in Style definitions, i.e. in format <code>&HAABBGGRR</code>.</p><p>Does not check input range.</p><h3 id=extract_color>extract_color<a href=#extract_color class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>r, g, b, a = util.extract_color(colorstring)</code>{:.language-lua}</p><p>Extracts colour components from a colour string. Several formats of colour strings are recognised:</p><ul><li>Style definition: <code>&HAABBGGRR</code></li><li>Inline override: <code>&HBBGGRR&</code></li><li>Alpha override: <code>&HAA&</code></li><li>HTML with alpha: <code>#RRGGBBAA</code></li></ul><p>Note that this function always returns four numbers when passed a valid colour string.
Unused values (depends on the format of the colour string) are assigned 0 (zero).
If an unrecognised colour string is passed, <code>nil</code> is returned.</p><p>{::template name=&ldquo;examplebox&rdquo;}</p><pre><code class=language-lua>r, g, b, a = extract_color(&quot;&amp;H7F&amp;&quot;)
</code></pre><p><code>r</code>, <code>g</code>, and <code>b</code> will be 0; <code>a</code> will be 127.
{:/}</p><h3 id=alpha_from_style>alpha_from_style<a href=#alpha_from_style class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>alphastring = util.alpha_from_style(coloralphastring)</code>{:.language-lua}</p><p>Returns the alpha part of a colour string, as an alpha override string, i.e. <code>&HAA&</code> format.
This function is a composition of <code>extract_color</code> and <code>ass_alpha</code>.</p><h3 id=color_from_style>color_from_style<a href=#color_from_style class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>colorstring = util.color_from_style(coloralphastring)</code>{:.language-lua}</p><p>Returns the colour part of a colour string, as a colour override string, i.e. <code>&HBBGGRR&</code> format.
This function is a composition of <code>extract_color</code> and <code>ass_color</code>.</p><h3 id=hsv_to_rgb>HSV_to_RGB<a href=#hsv_to_rgb class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>r, g, b = util.HSV_to_RGB(h, s, v)</code>{:.language-lua}</p><p>Transforms a colour given in Hue, Saturation, Value space into Red, Green, Blue space.</p><p><code>h</code> is given in degrees.
The nominal range is 0..359; values outside this range will be translated into it.
Input range of <code>s</code> and <code>v</code> are 0..1.
These are not range checked.
Output range of <code>r</code>, <code>g</code> and <code>b</code> are 0..255.</p><h2 id=string-functions>String functions<a href=#string-functions class=anchor aria-hidden=true>#</a></h2><p>Because the Lua standard <code>string</code> library is fairly limited, a few additional helper functions are provided.
See also <a href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/automation/lua/modules/unicode/>unicode</a>.</p><h3 id=stringtrim>string.trim<a href=#stringtrim class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>outstring = util.trim(instring)</code>{:.language-lua}</p><p>Removes all space characters at the start and end of the input string, and returns the transformed string.</p><p>Warning: This function is not UTF-8 safe.
It uses the Lua regex <code>%s</code> class to match spaces, which in some legacy encodings will result in it also matching some prefix bytes in UTF-8 encoded text.</p><h3 id=stringheadtail>string.headtail<a href=#stringheadtail class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>head, tail = util.headtail(instring)</code>{:.language-lua}</p><p>Splits a string by first space-sequence into a &ldquo;head&rdquo; and a &ldquo;tail&rdquo;, similar to the handling of linked lists in several functional languages.</p><p>If <code>instring</code> does not contain any space characters it returns <code>instring, ""</code>.</p><h3 id=stringwords>string.words<a href=#stringwords class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>for word in util.words(instring) do ... end</code>{:.language-lua}</p><p>Returns an iterator function for use in a <code>for</code> loop, to loop over all the words in the string using <code>string.headtail</code> semantics.</p><h2 id=numeric-functions>Numeric functions<a href=#numeric-functions class=anchor aria-hidden=true>#</a></h2><p>Functions to handle various operations on numbers.</p><h3 id=clamp>clamp<a href=#clamp class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>outval = util.clamp(inval, min, max)</code>{:.language-lua}</p><p>Clamps <code>inval</code> to be in range <code>min</code>..<code>max</code>.</p><h3 id=interpolate>interpolate<a href=#interpolate class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>outval = util.interpolate(t, a, b)</code>{:.language-lua}</p><p>Interpolates between <code>a</code> and <code>b</code>.
<code>t</code> is the time variable in range 0..1.
Values outside this range are clamped.</p><h3 id=interpolate_color>interpolate_color<a href=#interpolate_color class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>outcolor = util.interpolate_color(t, color1, color2)</code>{:.language-lua}</p><p>Interpolate between <code>color1</code> and <code>color2</code> with <code>t</code> as time variable in range 0..1.
<code>color1</code>, <code>color2</code> and <code>outcolor</code> are colour strings, and <code>outcolour</code> will be in colour override format.</p><h3 id=interpolate_alpha>interpolate_alpha<a href=#interpolate_alpha class=anchor aria-hidden=true>#</a></h3><p>Synopsis: <code>outalpha = util.interpolate_alpha(t, alpha1, alpha2)</code>{:.language-lua}</p><p>Similar to <code>interpolate_color</code>, but interpolates alpha values instead.
Also works on colour strings, and will return an alpha override string.</p><p>{::template name=&ldquo;automation_navbox&rdquo; /}</p><div class="docs-navigation d-flex justify-content-between"><a href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/automation/lua/modules/unicode/><div class="card my-1"><div class="card-body py-2">&larr;</div></div></a><a class=ms-auto href=https://aeg-dev.github.io/AegiSite/docs/3.2/en/automation/lua/progress_reporting/><div class="card my-1"><div class="card-body py-2">&rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://www.networkredux.com/>NetworkRedux</a>, <a href=https://gohugo.io/>Hugo</a>, and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=https://aeg-dev.github.io/AegiSite/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script src=https://aeg-dev.github.io/AegiSite/js/highlight.min.23f16da133548e29aa8de3077755353b92ab613aeb6543a7f26b0e897536bde8c6fe45e68ef6d13d6de184f6b7199e781aaebd156dbcaacd50e849b8b2ec0991.js integrity="sha512-I/FtoTNUjimqjeMHd1U1O5KrYTrrZUOn8msOiXU2vejG/kXmjvbRPW3hhPa3GZ54Gq69FW28qs1Q6Em4suwJkQ==" crossorigin=anonymous defer></script><script src=https://aeg-dev.github.io/AegiSite/main.min.cb1cfa565384689404329cbf8ad4a175b59ac6421a528ad947882d8242fc7b62b773cd5967a10349256154f6a67bcdeeb3da0729191ddd4f5623442999e53004.js integrity="sha512-yxz6VlOEaJQEMpy/itShdbWaxkIaUorZR4gtgkL8e2K3c81ZZ6EDSSVhVPame83us9oHKRkd3U9WI0QpmeUwBA==" crossorigin=anonymous defer></script><script src=https://aeg-dev.github.io/AegiSite/index.min.bcfae6a660c12f93bb0e1fbf0766f0b78229d3ed3e619b1aa2733638c14654814c48251efda05dfdd02b9d0d591a82ecc21ddcdc87bd336a286834f6fef49e1b.js integrity="sha512-vPrmpmDBL5O7Dh+/B2bwt4Ip0+0+YZsaonM2OMFGVIFMSCUe/aBd/dArnQ1ZGoLswh3c3Ie9M2ooaDT2/vSeGw==" crossorigin=anonymous defer></script></body></html>